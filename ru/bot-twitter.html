<!DOCTYPE html>
<html lang="ru">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-189480841-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-189480841-2');
</script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Favicon (Mobile and Desktop) -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Создаем простого бота Twitter с Node.js - Сергей Ермилов</title>
    <meta name="description" content="Создадим простого бота в Twitter с использованием Javascript и Node.js и 38 строк кода" />

    <!-- Bootstrap -->  
    <link rel="stylesheet" href="/assets/bootstrap4v/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Syntax -->
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css">
    <!-- Main Style.CSS -->
    <link href="/assets/css/style.css" rel="stylesheet">

</head>
<body>
<!-- Header Start -->

<div class="container-fluid">
    <div class="maxwidth">
    <div class="row">
        <div class="col">
<header>


            <nav class="navbar navbar-expand-lg navbar-light">

              <a class="navbar-brand" href="/ru/"><img src="/assets/svg/smlogo.svg" width="20" height="20" alt="Sergei Ermilov"> Сергей Ермилов.</a>

              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>

              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto">
                  <li class="nav-item">
                    <a class="nav-link" href="/work.html">Сделано.</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/about.html">Кто я. <span class="sr-only">(current)</span></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/contact.html">Контакты.</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/tools.html">Сервисы.</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/"><img src="/assets/svg/usa.svg" alt="English" class="language-flag"></a>
                  </li>
                </ul>
              </div>
            </nav>

</header>
<!-- Header End -->
</div>
</div>
</div>
</div>
    
<div class="container-fluid my-5">
    <div class="maxwidth">
        <div class="row">
            <div class="col-lg-12">
                Вернуться в <a href="/ru/">Блог</a>
            </div>
            <div class="col-lg-8 imgmax">
                <h1>Создаем простого бота Twitter с Node.js</h1>
<p>Создадим простого бота в Twitter с использованием Javascript и Node.js и 38 строк кода.</p>
<p>Это первый урок в серии из нескольких частей. В следующих статьях я покажу вам, как добавить более продвинутую функциональность нашему боту. На данный момент мы собираемся создать очень простого бота в Twitter, который будет лайкать тех, кто пишет на определенные темы.</p>
<p>Готовы? Давай сделаем это. Вот что нам понадобится:</p>
<ul><li><strong>API Twitter</strong>: если у вас есть учетная запись Twitter, вы можете использовать <a rel="noreferrer noopener" href="https://apps.twitter.com/app/new" target="_blank">API Twitter</a>. Вы можете прочитать документацию по API <a rel="noreferrer noopener" href="https://dev.twitter.com/docs" target="_blank">здесь</a>.</li><li><strong>Node.js</strong>: посетите <a rel="noreferrer noopener" href="https://nodejs.org/en/" target="_blank">официальный сайт Node.js</a>, чтобы загрузить и установить Node, если вы этого еще не сделали.</li><li><strong>Twitter NPM</strong>: модуль <a href="https://www.npmjs.com/package/twitter" target="_blank" rel="noreferrer noopener">NPM Twitter</a>, который позволяет легко взаимодействовать с API Twitter.</li></ul>
<h2 id="create">Создаем приложение</h2>
<p>Основная причина, по которой этот бот будет работать, это API Twitter. На самых базовых уровнях API - это просто способ взаимодействия одной программы с другой.</p>
<p>Мы будем создавать приложение Node.js, которое взаимодействует с API Twitter. В этом приложении API позволит нам искать твиты и добавлять их в избранное.</p>
<p>Чтобы использовать Twitter API, нам нужна информация! Зайдите в Twitter API и создайте новое приложение.</p>
<p><img src="/assets/pictures/nodeja-bot-twitter-1.png.webp" alt="" /></p>
<p>Вам нужно будет заполнить некоторую информацию, а затем найти лополнительную информацию на вкладке Ключи и токены доступа (Keys и Access Tokens). Возможно, вам придется нажать «Создать токен доступа» (Generate Access Token), чтобы создать свой токен доступа.</p>
<ul><li>Consumer Key</li><li>Consumer Secret</li><li>Access Token Key</li><li>Access Token Secret</li></ul>
<p><img src="/assets/pictures/nodeja-bot-twitter-2.png.webp" alt="" /></p>
<p>Как только вы увидите эти ключи, вы будете готовы перейти к следующему разделу.</p>
<h2 id="config">Конфигурация</h2>
<p>Теперь, когда у нас есть необходимая информация о приложении, давайте настроим нашего бота.</p>
<p>1. Создайте пустой каталог с именем <code>twitter-bot</code> и запустите:</p>
<pre><code class="language-bash">$ npm init</code></pre>
<p>2. Заполните необходимую информацию для инициализации нашего проекта.</p>
<p>Вот как выглядел мой файл <code>package.json</code> после инициализации моего проекта. Примечание: ваш может выглядеть немного иначе, это нормально.</p>
<pre ><code class="language-json">{
  "name": "twitter-bot",
  "version": "1.0.0",
  "description": "Nodejs Twitter Bot",
  "main": "app.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/bmorelli25/Twitter-Bot.git"
  },
  "author": "Brandon Morelli",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/bmorelli25/Twitter-Bot/issues"
  },
  "homepage": "https://github.com/bmorelli25/Twitter-Bot#readme"
}</code></pre>
<p>3. Затем мы сохраним нашу необходимую зависимость, выполнив:</p>
<pre><code class="language-bash">$ npm install --save twitter</code></pre>
<p>4. Создайте два файла, <code>config.js</code> и <code>app.js</code></p>
<p>Наш файл <code>config.js</code> будет хранить информацию о конфигурации. Файл <code>app.js</code> будет содержать код нашего бота твиттера.</p>
<p>5. Давайте добавим информацию о приложении Twitter сверху в наш файл <code>config.js</code>. Замените каждое из полей ниже соответствующими данными приложения, которые вы получили в Twitter.</p>
<pre><code class="language-javascript">// config.js
module.exports = {
  consumer_key: '',
  consumer_secret: '',
  access_token_key: '',
  access_token_secret: ''
}</code></pre>
<p>6. Теперь мы можем запросить (<code>require</code>) две зависимости в файле <code>app.js</code>:</p>
<pre><code lang="javascript" class="language-javascript">// app.js
var Twitter = require('twitter');
var config = require('./config.js');</code></pre>
<p>7. Теперь, когда у нас есть уже кое-что, пришло время собрать все воедино. Мы делаем это, передавая наши детали конфигурации в Twitter. Добавьте следующий код в <code>app.js</code>:</p>
<pre><code lang="javascript" class="language-javascript">var T = new Twitter(config);</code></pre>
<p>На данный момент у нас сделаны все настройки. Детали нашего приложения (которые необходимы для взаимодействия с API Twitter) передаются в npm модуль Twitter.</p>
<p>Этот модуль npm упрощает процесс взаимодействия с API Twitter. Теперь мы можем отправлять и получать запросы к API, что позволит нам совершать действия в Twitter через нашего бота!</p>
<h2 id="delaem">Делаем бота</h2>
<p>Давайте представим как работают "лайки" в Твиттере: Есть две составляющие. Сначала вы ищете твиты, а затем выбираете один и добавляете его в избранное. Давайте сначала поработаем с функцией поиска.</p>
<p>Мы собираемся установить переменную <code>params</code>, которая будет содержать параметры поиска. Есть много параметров, которые мы можем использовать. Вы можете увидеть полный список в документации API Twitter по <a rel="noreferrer noopener" href="https://dev.twitter.com/rest/reference/get/search/tweets" target="_blank">этой ссылке</a>.</p>
<pre><code lang="javascript" class="language-javascript">var Twitter = require('twitter');
var config = require('./config.js');
var T = new Twitter(config);

// Настройка параметров поиска

var params = {
  q: '#nodejs',
  count: 10,
  result_type: 'recent',
  lang: 'en'
}</code></pre>
<p><code>q</code> является единственным обязательным параметром,который хранит наш поисковый запрос. В этом примере мы ищем твиты, содержащие <code>#nodejs</code>. Не стесняйтесь изменять его на любой запрос, который вы хотите.</p>
<p>Я также использую три дополнительных параметра поиска:</p>
<p><code>count</code> - укажите количество твитов, которые вы хотите вернуть</p>
<p><code>result_type: 'recent'</code> - возвращает только самые последние результаты</p>
<p><code>lang: 'en'</code> - возвращает только результаты на английском языке</p>
<p>Теперь, когда у нас есть параметры поиска, мы подключаем их к запросу <code>get</code>, чтобы мы могли найти некоторые твиты.</p>
<pre><code lang="javascript" class="language-javascript">T.get('search/tweets', params, function(err, data, response) {
  if(!err){
    // This is where the magic will happen
  } else {
    console.log(err);
  }
})</code></pre>
<p>Чтобы глубже понять, что здесь происходит, вам нужно прочитать <a rel="noreferrer noopener" href="https://dev.twitter.com/rest/reference/get/search/tweets" target="_blank">документацию по API Twitter для поиска/твитов GET</a>, но я постараюсь ниже описать базовые понятия.</p>
<p>С помощью модуля Twitter <strong>npm</strong> мы можем сделать запрос get <code>‘search/tweets’</code> (поиск/твиты) и передать в <code>params</code>, который мы установили ранее. Этот запрос get возвращает обратный вызов. Если в этом обратном вызове нет ошибок, мы запустим наш код, чтобы добавить твит в избранное. Если есть ошибка, мы создадим лог и всё.</p>
<p>Отлично, теперь нам просто нужно добавить код в оператор <code>if(!err)</code> выше.</p>
<p>Наш get запрос возвращает массив из нескольких твитов через объект <code>data.statuses</code>. Таким образом, нам нужно пройтись по всем твитам в этом массиве и выбрать каждый из них в отдельности. Вот как мы это делаем:</p>
<pre><code lang="javascript" class="language-javascript">// Loop through the returned tweets
    for(let i = 0; i &lt; data.statuses.length; i++){
      // Get the tweet Id from the returned data
      let id = { id: data.statuses[i].id_str }
      // Try to Favorite the selected Tweet
      T.post('favorites/create', id, function(err, response){
        // If the favorite fails, log the error message
        if(err){
          console.log(err[0].message);
        }
        // If the favorite is successful, log the url of the tweet
        else{
          let username = response.user.screen_name;
          let tweetId = response.id_str;
          console.log('Favorited: ', `https://twitter.com/${username}/status/${tweetId}`)
        }
      });
    }</code></pre>
<ol><li>Мы создаем цикл <code>for</code> и проходим каждый твит (пока не достигнем длины <code>data.statuses</code>).</li><li>Внутри нашего цикла <code>for</code> мы фиксируем идентификатор твита, используя <code>data.statuses[i].id_str</code>. Нам нужен этот идентификатор для нашего <code>post</code> запроса.</li><li>Создаем post запрос <code>'favorites/create'</code> (избранное/создать). Этот роут API, который используется для добавления твита в избранное. Мы передаем наш идентификатор твита и запрос возвращает обратный вызов (колбек или callback).</li><li>В нашем колбеке мы ищем ошибку. Если есть ошибка, мы фиксируем логи с сообщением об ошибке. В большинстве случаев появляется сообщение об ошибке, потому что мы пытаемся добавить в избранное твит, который мы уже добавили в избранное.</li><li>Если ошибки нет, бот будет добавлять твит в избранное. В качестве дополнительного бонуса я использую возвращенный объект для создания URL нового избранного твита. Этот URL-адрес затем записывается в консоль, что позволяет легко увидеть, какие твиты предпочитает бот.</li></ol>
<h2 id="zapusk">Запуск бота</h2>
<p>Готово! Запустите вашего бота через командную строку:</p>
<pre><code lang="javascript" class="language-javascript">$ node app.js</code></pre>
<p>Вот и всё! Наш бот добавляет в избранное и записывает URL каждого твита.</p>
<h2 id="kod">Код бота целиком</h2>
<p>Вот как выглядит итоговый файл <code>app.js</code>. Также код можно посмотреть на <a href="https://github.com/bmorelli25/Twitter-Favorite-Bot" target="_blank" rel="noreferrer noopener">GitHub</a> автора идеи, так что заходите туда, если вы хотите скачать и поиграть с ботом!</p>
<pre><code lang="javascript" class="language-javascript">var Twitter = require('twitter');
var config = require('./config.js');
var T = new Twitter(config);

// Set up your search parameters
var params = {
  q: '#nodejs',
  count: 10,
  result_type: 'recent',
  lang: 'en'
}

// Initiate your search using the above paramaters
T.get('search/tweets', params, function(err, data, response) {
  // If there is no error, proceed
  if(!err){
    // Loop through the returned tweets
    for(let i = 0; i &lt; data.statuses.length; i++){
      // Get the tweet Id from the returned data
      let id = { id: data.statuses[i].id_str }
      // Try to Favorite the selected Tweet
      T.post('favorites/create', id, function(err, response){
        // If the favorite fails, log the error message
        if(err){
          console.log(err[0].message);
        }
        // If the favorite is successful, log the url of the tweet
        else{
          let username = response.user.screen_name;
          let tweetId = response.id_str;
          console.log('Favorited: ', `https://twitter.com/${username}/status/${tweetId}`)
        }
      });
    }
  } else {
    console.log(err);
  }
})</code></pre>
<p>Вот список возможных улучшений и дополнений, которые мы можем сделать для нашего Twitter бота в будущем:</p>
<ul><li>Добавить ретвит функциональности</li><li>Ответ на твиты на определенную тему / хэштег</li><li>Ответить пользователям, если они подписались на вас</li><li>Следить за людьми</li><li>Запуск бота на сервере, а не локально</li></ul>


            </div>

            <div class="col-lg-4">
                <p><strong>Содержание</strong></p>
                <p><a href="#create">Создаем приложение</a></p>
                <p><a href="#config">Конфигурация</a></p>
                <p><a href="#delaem">Делаем бота</a></p>
                <p><a href="#zapusk">Запуск бота</a></p>
                <p><a href="#kod">Код бота целиком</a></p>
            </div>
		</div>
	</div>
</div>

   
<!-- Footer Start -->
<footer class="footer">
  <div class="container-fluid bg-light mt-4">
      <div class="maxwidth">
          <div class="row align-items-center py-4">

                  <div class="col copyright">
                      Copyright &copy; Sergei Ermilov
                  </div>
                  <div class="col text-right">
                      <a href="https://github.com/sergeiermilov" title="My GitHub" target="_blank"><img src='/assets/svg/gh.svg' alt="My GitHub" title="My GitHub"></a>
                      <a href="https://www.behance.net/sergeiermilov" title="My Behance" target="_blank"><img src='/assets/svg/bh.svg' alt="My Behance" title="My Behance"></a>
                  </div>
              </div>
          </div>
    </div>
</footer>
<!-- Footer End -->

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="/assets/bootstrap4v/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>
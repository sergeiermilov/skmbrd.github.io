<!DOCTYPE html>
<html lang="ru">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-189480841-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-189480841-2');
</script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Favicon (Mobile and Desktop) -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">

    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Wordpress - полное руководство - Сергей Ермилов</title>
    <meta name="description" content="Большое руководство для тех, кто планирует заниматься разработкой сайтов на Wordpress">

    <!-- Bootstrap -->  
    <link rel="stylesheet" href="/assets/bootstrap4v/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Syntax -->
    <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css">
    <!-- Main Style.CSS -->
    <link href="/assets/css/style.css" rel="stylesheet">

</head>
<body>
<!-- Header Start -->

<div class="container-fluid">
    <div class="maxwidth">
    <div class="row">
        <div class="col">
<header>


            <nav class="navbar navbar-expand-lg navbar-light">

              <a class="navbar-brand" href="/ru/"><img src="/assets/svg/smlogo.svg" width="20" height="20" alt="Sergei Ermilov"> Сергей Ермилов.</a>

              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>

              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto">
                  <li class="nav-item">
                    <a class="nav-link" href="/work.html">Сделано.</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/about.html">Кто я. <span class="sr-only">(current)</span></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/contact.html">Контакты.</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/tools.html">Сервисы.</a>
                  </li>
                </ul>
              </div>
            </nav>

</header>
<!-- Header End -->
</div>
</div>
</div>
</div>
    
<div class="container-fluid my-5">
    <div class="maxwidth">
        <div class="row">

          <div class="col-lg-12">
            Вернуться в <a href="/ru/">Блог</a>
          </div>
            
            <div class="col-lg-8">
              <h1>Wordpress - полное руководство</h1>
<p>Большое руководство для тех, кто планирует заниматься разработкой сайтов на Wordpress</p>
<h2 id="iskluchaem">Исключаем страницы из поиска Wordpress</h2>
<p>Для того, чтобы убрать из поиска сайта на Wordpress страницы мы должны в файл функций (<strong>functions.php</strong>) нашей темы добавить следующий сниппет:</p>
<pre><code class="language-php">if (!is_admin()) {
	function wpb_search_filter($query) {
		if ($query-&gt;is_search) {
			$query-&gt;set('post_type', 'post');
		}
	return $query;
	}
	add_filter('pre_get_posts','wpb_search_filter');
}</code></pre>
<p>Напоминаю, что в разных темах функции могут храниться в разных файлах, но как правило в большинстве шаблонов этот файл - <strong>functions.php</strong>, куда и нужно добавить код.</p>
<h2 id="zamena-url">Как поменять URL в постах Wordpress через MySQL?</h2>
<p>Частая ситуация после переноса сайта на новый домен или в папку или на поддомен - это смена адресов (<strong>url</strong>) страниц и ссылок.</p>
<p>Если статей много, то самый простой способ - это воспользоваться минимальными действиями с базой данных MySQL. С помощью элементарных команд можно поменять не только домен, но и отдельную часть домена, например, когда вы переносите сайт в папку.</p>
<p>Допустим, что у нас сайт находился в папке / и мы решили вернуть сайт в корень. Что делать со ссылками и адресами изображений в статьях? Мы воспользуемся простейшим запросом к базе данных MySQL:</p>
<pre><code class="language-sql">UPDATE wp_posts SET post_content = REPLACE (post_content, '/wp-content/', '/wp-content/');</code></pre>
<p>Заметили, что мы не прописывали отдельный домен? Мы можем заменить таким образом любой фрагмент текста статьи на нужный нам, а не только сам URL. </p>
<p>Также приведу три основных запроса к Базе Данных, которыми пользуюсь сам на протяжении уже нескольких лет:</p>
<pre><code class="language-sql">UPDATE wp_options SET option_value = replace(option_value, 'http://domain.ru', 'http://newdomain.ru') WHERE option_name = 'home' OR option_name = 'siteurl';

UPDATE wp_posts SET guid = replace(guid, 'http://domain.ru','http://newdomain.ru');

UPDATE wp_posts SET post_content = replace(post_content, 'http://domain.ru', 'http://newdomain.ru');</code></pre>
<ul><li><strong>http://domain.ru</strong> - старый домен (*)</li><li><strong>http://newdomain.ru</strong> - новый домен</li></ul>
<p>* - поменяйте на свои</p>
<p>Этих трех запросов хватает в большинстве случаев при переезде и переносе сайта на другой домен, в папку или на поодомен.</p>
<h2 id="video">Делаем видео Youtube адаптивным</h2>
<p>Делаем небольшое решение и добавляем код, который позволит сделать видео Youtube адаптивными. Любые <code>iframe</code>-ы для любого адаптивного сайта очень сомнительное решение и причиняют боль любому вебмастеру. Но, к сожалению, различные сервисы часто используют именно <code>iframe</code>.</p>
<p>И, конечно, этим страдает всеми любимый YouTube. К счастью, есть несколько простых решений, которые мы можем использовать в своей теме WordPress для автоматического изменения размера встраиваемых видео, чтобы они аккуратно размещались в статьях на сайте.</p>
<p>Код, который я приведу ниже, оборачивает <code>iframe</code> в <code>div</code> и добавляет некоторые классы. Затем CSS изменяет размер объекта до правильной пропорции 16:9.</p>
<p>Как обычно мы будем работать с двумя файлами нашей темы - <strong>functions.php</strong> и <strong>style.css</strong>. Скорее всего в вашей теме используются именно эти файлы. Для начала добавляем следующий код в ваш файл <strong>functions.php</strong>:</p>
<pre><code lang="php" class="language-php">add_filter('the_content', function($content) {
	return str_replace(array("&lt;iframe", "&lt;/iframe>"), array('&lt;div class="iframe-container">&lt;iframe', "&lt;/iframe>&lt;/div>"), $content);
});

add_filter('embed_oembed_html', function ($html, $url, $attr, $post_id) {
	if(strpos($html, 'youtube.com') !== false || strpos($html, 'youtu.be') !== false){
  		return '&lt;div class="embed-responsive embed-responsive-16by9">' . $html . '&lt;/div>';
	} else {
	 return $html;
	}
}, 10, 4);


add_filter('embed_oembed_html', function($code) {
  return str_replace('&lt;iframe', '&lt;iframe class="embed-responsive-item" ', $code);
});</code></pre>
<p>Далее, мы должны добавить в файл со стилями (скорее всего в вашем случае style.css) следующие стилевые решения:</p>
<pre><code lang="css" class="language-css">.embed-responsive {
  position: relative;
  display: block;
  height: 0;
  padding: 0;
  overflow: hidden;
}
.embed-responsive .embed-responsive-item,
.embed-responsive iframe {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: 0;
}
.embed-responsive-16by9 {
  padding-bottom: 56.25%;
}</code></pre>
<p>На этом всё. Больше ничего мы добавлять не будем. Совсем скоро я выложу для удобства плагин, который сделает видео Youtube адаптивными, чтобы никому не понадобилось ковыряться в файлах темы, что не всегда правильно делать, т.к. темы периодически обновляются.</p>
<h2 id="zapret-redirect">Запрещаем автоматические редиректы</h2>
<p>Wordpress имеет функцию, благодаря которой он автоматически перенаправляет ваши URL, т.е. делает редирект, если считает, что адрес написан неправильно. Он подбирает самостоятельно "подходящий" <strong>url</strong> и редиректит на него. </p>
<p>Возьмем пример. У нас есть страница под названием <code>my-page</code>. Если мы обращаемся к ней по вот такому адресу:</p>
<pre><code lang="bash" class="language-bash">www.mysite.com/something/my-page/</code></pre>
<p>Wordpress сразу же перенаправит на:</p>
<pre><code lang="bash" class="language-bash">www.mysite.com/my-page/</code></pre>
<p>Это происходит, т.к. по первому адресу страницы не существует и Wordpress автоматом перенаправляет на второй url. Это не очень удобно, точнее - не очень контролируемый процесс даже с точки зрения SEO.</p>
<p>Как можно отключить эту функцию и вместо редиректа получать страницу с 404 ошибкой?</p>
<p>На самом деле ответ очень простой. Мы добавляем в файл <code>functions.php</code> вот такую строчку кода:</p>
<pre><code lang="php" class="language-php">remove_action('template_redirect', 'redirect_canonical');</code></pre>
<p>Но стоит сделать важное замечание. Если вы понаблюдаете, что происходит (через <strong>HttpFox</strong>, <strong>WireShark</strong> или аналогичный анализатор пакетов), то страницы автоматически перенаправляются с помощью 301 редиректа ("перемещено навсегда"), что является вполне подходящим поведением.</p>
<p>Считается, что это помогает поисковым системам поддерживать свои базы данных в актуальном состоянии, а перенаправление помогает пользователям находить страницы. </p>
<p>Будьте аккуратны. Это может повлиять на то, как WordPress обрабатывает процессы. В любом случае, - это ваш выбор, но не все уверены в том, что это хорошая идея.</p>
<p>Если посмотреть на функцию <code>redirect_canonical</code> в <code>canonical.php</code>, то вы также можете изменить поведение с помощью своего собственного фильтра.</p>
<p>В конце функции <code>redirect_canonical()</code> есть вызов для фильтрации окончательного ответа:</p>
<pre><code lang="php" class="language-php">$redirect_url = apply_filters( 'redirect_canonical', $redirect_url, $requested_url );</code></pre>
<p>Таким образом, вы можете написать свой собственный фильтр для изменения окончательного перенаправления или вернуть значение <code>null</code>, чтобы остановить перенаправление на основе ввода, тем самым отключив функцию для определенного URL-адреса или подмножества URL-адресов.</p>
<h2 id="update-fail">Updating failed. You are probably offline.</h2>
<p>С недавнего времени столкнулся с проблемой, когда в Wordpress при сохранении черновика появляется надпись "<strong><em>updating failed. you are probably offline</em></strong>" (рус. - обновление не удалось). И да, эта проблема часто возникает у тех, кто пользуется Gutenberg.</p>
<p>Буквально недавно я каким-то образом проникся этим редактором, хотя всё предыдущее время постоянно ставил плагин "Classic Editor", который возвращал старый добрый вордпрессовский редактор.</p>
<p>Для решения "updating failed" пришлось копать весь Google, но большинство решений сводилось к тому, чтобы установить плагин "Classic Editor" и не мучиться.</p>
<p>Но скажем честно, классический редактор - это костыль. Так как со временем все перейдут на новый Gutenberg, т.к. он удобнее априори.</p>
<p>Итак, если вы хотите быстрое решение в виде костыля - бежим и устанавливаем плагин <a href="https://wordpress.org/plugins/classic-editor/" target="_blank" rel="noreferrer noopener">Classic Editor</a>.</p>
<p>Ну а тем, кто хочет разобраться - я подскажу направление куда копать.</p>
<p>Реальная проблема заключается в SSL и здесь два варианта:</p>
<ol><li>Установлен непонятный SSL</li><li>Криво сделана переадресация на HTTPS.</li></ol>
<p><strong>Первый вариант</strong> - редкий и скорее всего для решения достаточно написать хостеру и попросить проверить всё ли нормально с сертификатом и правильно ли он установлен.</p>
<p>Если хостер скажет, что всё окай, то переходим ко второму варианту.</p>
<p><strong>Второй вариант</strong> заключается в том, что есть, скажем так, конфликт переадресаций. Обычно после установки Wordpress на сайт с SSL в настройках мы прописываем HTTPS, плюс у WP есть внутренняя умная переадресация. Но также есть редирект на сервере с HTTP на HTTPS.</p>
<p>И когда всё настроено криво, то при редактировании статей мы получаем ошибку "Mixed content", которую можно увидеть в консоли (например):</p>
<p><img src="/assets/pictures/mixed-content-wp.jpg" alt="" /></p>
<p>Какие действия можно предпринять?</p>
<p>1. После установки SSL на сервер мы прописываем в настройках (<strong>Настройки</strong> -&gt; <strong>Общие</strong>) адрес Адрес WordPress (URL) и Адрес сайта (URL) с HTTPS.</p>
<p>2. Можно более жестко прописать в корне сайта в файле wp-config.php строки:</p>
<pre><code lang="php" class="language-php">define('WP_SITEURL', 'https://' . $_SERVER['HTTP_HOST'] . '/');
define('WP_HOME', 'https://' . $_SERVER['HTTP_HOST'] . '/');</code></pre>
<p>Если вы пропишете эти строки, то не сможете редактировать адреса через настройки.</p>
<p>3. Устанавливаем плагин <a href="https://ru.wordpress.org/plugins/really-simple-ssl/" target="_blank" rel="noreferrer noopener">Really Simple SSL</a> и активизируем его. Включаем редиректы в нем.</p>
<p>4. Далее мы можем прописать в файле .htaccess следующие строчки:</p>
<pre><code lang="php" class="language-php">&lt;IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ http://%1/$1 [R=301,L]
&lt;/IfModule></code></pre>
<p>Зачем они нужны?</p>
<p>Очень часто при установке SSL и настройки переадресации с HTTP на HTTPS мы забываем делать переадресацию, например, с WWW на без-WWW, т.е. когда URL <strong>https://www.site.ru</strong> редиректит на <strong>https://site.ru</strong>. Эти строчки выше прописываются в htaccess с этой целью.</p>
<p>Конечно, вы должны понимать, что случаи бывают разные и как правило лучше всего обращаться к хостеру, но если у вас на сервере Apache, то решение выше вполне может вам подойти.</p>
<h2 id="kol-slov">Gutenberg: количество слов</h2>
<p>Вчера осознал, что не могу найти количество слов в статье, которую пишу на сайте на Wordpress. Когда ты занимаешься медиа-проектами всегда смотришь статистику любой статьи, т.к. это важно для того же SEO.</p>
<p>Например, считается, что Google не очень хорошо воспринимает статьи в которых менее 300 слов. Кстати, Wordpress изначально заточен под то, чтобы показывать статистику именно слов по-умолчанию, а не символов, как принято в рунете.</p>
<p><img src="/assets/pictures/wordpress-kolichestvo-slov.jpg.webp" alt="" /></p>
<p>Но в редакторе Гутенберга (Gutenberg) внизу статьи мы ничего не найдем.</p>
<p>Когда первый раз задумываешься о поиске статистики, то всё сделано, на первый взгляд, не очень интуитивно.</p>
<p>Найти количество слов можно теперь в верхней части экрана, нажав на значок "структура статьи" (англ. - Content structure). </p>
<p><img src="/assets/pictures/wp-kolichestvo-slov.jpg.webp" alt="" /></p>
<p>Это не очень интуитивно из-за значка (i), который воспринимается как восклицательный знак, который лучше было бы заменить на знак вопроса, например.</p>
<p>"Структура статьи" в редакторе Гутенберга не только показывает количество слов, но также показывает статистику по:</p>
<ul><li>Заголовкам;</li><li>Параграфам или абзацам;</li><li>Блокам.</li></ul>
<p>Таким образом, он предлагает немного больше информации, чем классический редактор, что, конечно, приятно.</p>
<h2 id="nonces">Nonces и их использование</h2>
<p>Рассмотрим что такое одноразовые числа Nonces, их использование в Wordpress и цель применения.</p>
<p>Когда вы входите в WordPress, вам назначается куки-файл (cookie), - маленький файл, который живет в вашем браузере и действует как ваш "закулисный пропуск" в админ панель WordPress. </p>
<p>Это предотвращает несанкционированный доступ неавторизованных лиц к административной панели и совершение плохих поступков. У них нет куки, поэтому они останавливаются у двери "вышибалой". </p>
<p>Ваш куки привязан к учетной записи пользователя, которая связана с системой возможностей WordPress, которая контролирует то, что вы можете и чего не можете делать в админ панели. Это аутентификация: проверка того, что лицо, выполняющее действия администратора, уполномочено на это.</p>
<p>Скажем, что вы вошли в систему WordPress. Вы можете кликать по ссылкам и отправлять формы, которые делают что-то в вашем блоге. Такие вещи, как изменение опций, удаление публикаций, создание пользователей и т.д. Что произойдет, если кто-то создаст ссылку или форму, которая укажет на Вашего администратора WordPress и попытается сделать что-то вредоносное?</p>
<p>Ну, если неавторизованное лицо отправит форму или нажмет на ссылку, ничего не произойдет. Они получают отказ браузера, потому что у них нет куки-файла для входа в систему. Но что, если вас обманули с этой ссылкой?</p>
<p>"Вышибала" впускает вас, и действие выполняется. У вас есть разрешение, но у вас не было намерения. Вы не хотели нажимать на ссылку, которая бы удалила сообщение. Вас обманули! Чтобы защитить себя от этого, WordPress должен убедиться, что вы намерены делать то, что делаете.</p>
<p>В прошлом WordPress делал следующее: он проверял, что страница, которую вы просматривали до начала действия, была страницей администратора WordPress.</p>
<p>То есть вы уже были внутри … ссылка или форма, по которой вы щелкнули, не были вредоносными; это было частью администратора WordPress. WordPress сделал это, проверив значение <strong>HTTP_REFERER</strong>, которое отправил ваш браузер.</p>
<p>У HTTP_REFERER есть проблемы. Во-первых, его можно подделать с помощью JavaScript в каком-нибудь популярном браузере. Во-вторых, некоторые брандмауэры или прокси удаляют эту информацию. Подмена означает, что это не безопасно.</p>
<p>Удаление реферера означает, что некоторые пользователи не смогут выполнять действия в своей учетной записи администратора WordPress. Я устал от того, что люди жалуются на то, что не могут использовать админ панель WordPress, и опасаются последствий для безопасности.</p>
<p>Я разместил это сообщение в списке WP-Hackers, после чего последовала большая дискуссия. Я предложил альтернативный метод проверки намерений и начиная с WordPress 2.0.3, эта система была реализована.</p>
<p>Одноразовый номер - это число, используемое один раз, и оно используется для целей верификации намерений в WordPress.</p>
<p>Думайте о nonces как о пароле, который меняется каждый раз, когда он используется. Реализация WordPress технически не является одноразовой, потому что электронный ключ меняется только каждые 12 часов и действует в течение 24 часов (то есть действительный ключ и предпоследний ключ действительны), но это достаточно близко.</p>
<p>Идея проста: мы проверяем, что запрос пользователя является преднамеренным, убеждаясь, что запрос происходит изнутри администратора WordPress. И мы делаем это, предоставляя им часть информации (nonce) при запросе первой страницы. Когда действие выполняется, часть информации передается и проверяется. Одноразовые номера могут быть заблокированы разными способами.</p>
<p>Они уникальны для установки WordPress, для пользователя WordPress, для действия, для объекта действия и для времени действия (24 часа). Это означает, что если что-то из этого изменится, одноразовое число будет недействительным.</p>
<p>Поэтому, если вы (каким-то образом) перехватите одноразовое число, используемое мной, у вас, прежде всего, будет только 24 часа, чтобы использовать этот ключ, чтобы попытаться обмануть меня. И вы сможете использовать этот ключ только для того, чтобы обманом заставить меня в моем блоге выполнить определенное действие для определенного элемента.</p>
<p>Таким образом, даже если у вас есть одноразовый номер, используемый для удаления сообщения, в худшем случае вы можете обмануть меня в удалении этого конкретного сообщения. Одноразовый номер бесполезен для любой другой цели.</p>
<p>Авторы плагинов, слушайте. Для предотвращения обратной совместимости при появлении диалогового окна «Вы уверены?», когда пользователи, не зависящие от <strong>HTTP_REFERER</strong>, взаимодействуют с вашими плагинами (особенно страницами опций), вам нужно добавить nonce-возможности в ваши плагины. Но не волнуйтесь - это легко.</p>
<p>Чтобы защитить <code>&lt;form&gt;</code> с помощью одноразового числа, просто используйте функцию <code>wp_nonce_field()</code> внутри (я бы сделал это сразу после открывающего тега). Для обратной совместимости используйте <code>function_exists()</code> для условного выполнения кода.</p>
<p>Строка, которую вы передаете функции, должна быть уникальной для вашего плагина. Используйте следующую договоренность: <code>plugin-name-action_object</code>.</p>
<p>Итак, если мой плагин называется «cool plugin» и действие, которое выполняет форма - «update options», а объект - «advanced options», я бы сделал: <code>cool-plugin-update-options_advanced</code>.</p>
<p>Часть «объект» не требуется, но если у вас есть несколько форм, защитите каждую с помощью другого объекта для обеспечения наивысшего уровня защиты.</p>
<pre><code lang="php" class="language-php">&lt;form ...>
&lt;?php
if ( function_exists('wp_nonce_field') ) 
	wp_nonce_field('plugin-name-action_' . $your_object); 
?></code></pre>
<p>Если вы выполняете действия, основанные на кликах по ссылкам, вы можете добавить одноразовые числа (nonces) в свои ссылки с помощью <code>wp_nonce_url()</code>, который принимает два параметра.</p>
<p>Первый - это URL-адрес ссылки, второй - ваш одноразовый ключ. Обратите внимание на использование <code>function_exists()</code> для обратной совместимости:</p>
<pre><code lang="php" class="language-php">&lt;?php
$link = 'your-url.php';
$link = ( function_exists('wp_nonce_url') ) ? wp_nonce_url($link, 'plugin-name-action_' . $your_object) : $link;
?>

&lt;a href="&lt;?php echo $link; ?>">link&lt;/a></code></pre>
<p>На сервере перед выполнением действия, защищенного одноразовым числом, просто вызовите это:</p>
<pre><code lang="php" class="language-php">&lt;?php check_admin_referer('plugin-name-action_' . $your_object); ?></code></pre>
<h2 id="zaprosi-vremya">Количество запросов и время загрузки</h2>
<p>Рассмотрим как отображать количество запросов и время загрузки страницы в WordPress.</p>
<p>Один из пользователей спросил, как другие сайты отображают количество запросов и время загрузки страницы в футере.</p>
<p>Обычно форумные движки внизу страницы отображают что-то вроде "страница загружена за N секунд при X запросах".</p>
<p>На некоторых Wordpress сайтах вы также можете увидеть в футере что-то вроде этого: "64 запроса за 1,248 сек". </p>
<p>На самом деле всё достаточно просто, достаточно вставить следующий код куда угодно в свои файлы темы Wordpress, например, footer.php:</p>
<pre><code lang="php" class="language-php">&lt;?php echo get_num_queries(); ?> запросов за &lt;?php timer_stop(1); ?> секунд.</code></pre>
<p>Обновите страницу и вы увидите количество запросов и время выполнения.</p>
<p>Вы можете вставить блок кода ниже в ваш текущий активный файл темы WordPress functions.php:</p>
<pre><code lang="php" class="language-php">function wpse_footer_db_queries(){
    echo '&lt;!-- '.get_num_queries().' запросов за '.timer_stop(0).' секунд. -->'.PHP_EOL;
}
add_action('wp_footer', 'wpse_footer_db_queries');</code></pre>
<p>Приведенный выше блок кода будет отображать HTML-комментарий в футере вашей темы перед <code>&lt;/body&gt;</code> и <code>&lt;/html&gt;</code>, содержащий количество запросов к базе данных и время, которое понадобилось для получения страницы.</p>
<p>Комментарий не будет виден обычному пользователю. Вы сможете увидеть его при просмотре кода страницы.</p>
<h2 id="update-jquery">Апдейт версии jQuery</h2>
<p>Если провести аудит в Chrome Developer Tools для WordPress, начиная с версии 4.9.8, то Google сообщит, что на сайте по-умолчанию используется jQuery версия 1.12.4, которая содержит две известных уязвимости безопасности.</p>
<p>Использование данной устаревшей версии jQuery уменьшает баллы, полученные сайтом в Lighthouse. И это не есть хорошо.</p>
<p>Удивительно, что Wordpress использует старый jQuery в ядре. Вероятно, создатели CMS думают об обратной совместимости. Многие темы и плагины сделаны были еще с учетом старой версии jQuery, а 3.x и, вероятно, 2.x, ломают темы и плагины.</p>
<p><strong>Внимание</strong>! Вы не должны заменять основную версию jQuery, особенно в панели администрирования. Так как многие функции ядра WordPress могут зависеть от этой версии. Также, другие плагины могут зависеть от версии jQuery, добавленной в ядро.</p>
<p>Если вы уверены, что хотите изменить версию ядра jQuery, то в этом случае вы можете добавить следующий код в файл <strong>functions.php</strong> вашей активной темы (еще лучше, если вы создадите для этого плагин):</p>
<pre><code lang="php" class="language-php">function replace_core_jquery_version() {
    wp_deregister_script( 'jquery' );
    // Измените URL, если вы хотите загрузить локальную копию jQuery с вашего собственного сервера
    wp_register_script( 'jquery', "https://code.jquery.com/jquery-3.1.1.min.js", array(), '3.1.1' );
}
add_action( 'wp_enqueue_scripts', 'replace_core_jquery_version' );</code></pre>
<p>Код выше заменит основную версию jQuery и вместо этого загрузит версию <strong>3.1.1</strong> с сервера Google.</p>
<p>Также, хотя это и не рекомендуется, для замены версии jQuery в <strong>wp-admin</strong> можно использовать следующую дополнительную строку кода:</p>
<pre><code lang="php" class="language-php">add_action( 'admin_enqueue_scripts', 'replace_core_jquery_version' );</code></pre>
<p>Для админки использование старой версии, в целом, не принципиально, т.к. на баллы Аудита это никак не сказывается.</p>
<p>Таким образом, даже после обновления WordPress, у вас будет версия jQuery, которую вы захотите.</p>
<p>Можно еще кое-что сделать.</p>
<p>Функция <code>replace_core_jquery_version</code> выше также удаляет <code>jquery-migrate</code> скрипт, добавленный ядром WordPress.</p>
<p>Это разумно, так как новейшая версия jQuery не будет корректно работать со старой версией <code>jquery-migrate</code>. Однако вы можете включить и более новую версию <code>jquery-migrate</code>. В этом случае используйте следующую функцию:</p>
<pre><code lang="php" class="language-php">function replace_core_jquery_version() {
    wp_deregister_script( 'jquery-core' );
    wp_register_script( 'jquery-core', "https://code.jquery.com/jquery-3.1.1.min.js", array(), '3.1.1' );
    wp_deregister_script( 'jquery-migrate' );
    wp_register_script( 'jquery-migrate', "https://code.jquery.com/jquery-migrate-3.0.0.min.js", array(), '3.0.0' );
}</code></pre>


            </div>
            <div class="col-lg-4">

              <p><strong>Содержание</strong></p>
              <p><a href="#iskluchaem">Исключаем страницы из поиска Wordpress</a></p>
              <p><a href="#zamena-url">Как поменять URL в постах Wordpress через MySQL?</a></p>
              <p><a href="#video">Делаем видео Youtube адаптивным</a></p>
              <p><a href="#zapret-redirect">Запрещаем автоматические редиректы</a></p>
              <p><a href="#update-fail">Updating failed. You are probably offline.</a></p>
              <p><a href="#kol-slov">Gutenberg: количество слов</a></p>
              <p><a href="#nonces">Nonces и их использование</a></p>
              <p><a href="#zaprosi-vremya">Количество запросов и время загрузки</a></p>
              <p><a href="#update-jquery">Апдейт версии jQuery</a></p>

            </div> 

        </div>
    </div>
</div>

   
<!-- Footer Start -->
<footer class="footer">
  <div class="container-fluid bg-light mt-4">
      <div class="maxwidth">
          <div class="row align-items-center py-4">

                  <div class="col copyright">
                      Copyright &copy; Sergei Ermilov
                  </div>
                  <div class="col text-right">
                      <a href="https://github.com/sergeiermilov" title="My GitHub" target="_blank"><img src='/assets/svg/gh.svg' alt="My GitHub" title="My GitHub"></a>
                      <a href="https://www.behance.net/sergeiermilov" title="My Behance" target="_blank"><img src='/assets/svg/bh.svg' alt="My Behance" title="My Behance"></a>
                  </div>
              </div>
          </div>
    </div>
</footer>
<!-- Footer End -->

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="/assets/bootstrap4v/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

</body>
</html>